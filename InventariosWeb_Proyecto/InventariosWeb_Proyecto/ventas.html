<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Ventas</title>

  <!-- Fuentes y estilos -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <link rel="stylesheet" href="ventas.css" />

  <!-- ================== CONFIGURACIÓN DE TEMA ================== -->
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#3B82F6",
            "background-light": "#F9FAFB",
            "background-dark": "#111827",
            "card-light": "#FFFFFF",
            "card-dark": "#1F2937",
            "text-light": "#1F2937",
            "text-dark": "#F9FAFB",
            "border-light": "#E5E7EB",
            "border-dark": "#374151",
          },
          fontFamily: {
            display: ["Roboto", "sans-serif"],
          },
        },
      },
    };

    function toggleTheme() {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
      );
    }

    // Mantener tema al recargar
    if (
      localStorage.getItem("theme") === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      document.documentElement.classList.add("dark");
    }

    // ================== FUNCIÓN DE CERRAR SESIÓN ==================
    function cerrarSesion() {
      const confirmar = confirm("¿Estás seguro de que deseas cerrar sesión?");
      if (confirmar) {
        alert("Sesión cerrada correctamente.");
        window.location.href = "index.html";
      } else {
        alert("Continuarás en la sesión actual.");
      }
    }
  </script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">

     <script>
  const role = localStorage.getItem('userRole');

  // Si no ha iniciado sesión
  if (!role) {
    window.location.href = 'index.html';
  }

  // Restricciones según el rol
  const currentPage = window.location.pathname.split("/").pop();

  if (role === 'Empleado' && (currentPage === 'usuario.html' || currentPage === 'reportes.html')) {
    alert('No tienes permiso para acceder a esta sección.');
    window.location.href = 'productos.html';
  }
</script>

  <div class="flex flex-col min-h-screen" id="app">

    <!-- ================== ENCABEZADO ================== -->
    <header class="flex items-center justify-between p-4 bg-card-light dark:bg-card-dark border-b border-border-light dark:border-border-dark shadow-md">
      <h1 class="text-xl font-bold">Gestión de Ventas</h1>
      <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" onclick="toggleTheme()">
        <span class="material-icons block dark:hidden">dark_mode</span>
        <span class="material-icons hidden dark:block">light_mode</span>
      </button>
    </header>

    <!-- ================== CONTENIDO PRINCIPAL ================== -->
    <main class="flex-grow p-4 overflow-y-auto mb-20">

      <!-- CALENDARIO -->
      <div class="bg-card-light dark:bg-card-dark p-4 rounded-lg shadow-md mb-6">
        <h2 class="text-lg font-semibold mb-4">Calendario</h2>

        <div class="flex justify-between items-center mb-3">
          <button id="prev-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">
            <span class="material-icons">chevron_left</span>
          </button>
          <h3 id="month-year" class="text-lg font-medium"></h3>
          <button id="next-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">
            <span class="material-icons">chevron_right</span>
          </button>
        </div>

        <table class="w-full text-center border-collapse">
          <thead>
            <tr>
              <th>Dom</th><th>Lun</th><th>Mar</th><th>Mié</th><th>Jue</th><th>Vie</th><th>Sáb</th>
            </tr>
          </thead>
          <tbody id="calendar-body"></tbody>
        </table>

        <p id="selected-date" class="mt-4 text-sm text-gray-600 dark:text-gray-400 italic">
          Fecha seleccionada: Ninguna
        </p>
      </div>

      <!-- FORMULARIO DE MOVIMIENTO -->
      <div class="bg-card-light dark:bg-card-dark p-4 rounded-lg shadow-md">
        <h2 class="text-lg font-semibold mb-4">Registrar Movimiento</h2>

        <form id="venta-form" class="space-y-4">
          <input type="hidden" id="venta-fecha" />

          <div>
            <label class="block text-sm font-medium" for="venta-cantidad">Cantidad:</label>
            <input id="venta-cantidad" type="number"
              class="mt-1 block w-full px-3 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-md focus:ring-primary focus:border-primary">
          </div>

          <div>
            <label class="block text-sm font-medium" for="venta-usuario">Usuario responsable:</label>
            <select id="venta-usuario"
              class="mt-1 block w-full px-3 py-2 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-md focus:ring-primary focus:border-primary">
              <option value="">-- Selecciona un usuario --</option>
            </select>
          </div>

          <div class="flex justify-end">
            <button type="submit"
              class="px-6 py-2 text-white bg-primary rounded-full hover:bg-blue-700 flex items-center gap-2">
              <span class="material-icons">save</span>
              Guardar
            </button>
          </div>
        </form>
      </div>
    </main>

    <!-- ================== BARRA DE NAVEGACIÓN ================== -->
    <nav class="bg-card-light dark:bg-card-dark border-t border-border-light dark:border-border-dark shadow-lg fixed bottom-0 left-0 w-full z-50">
      <div class="flex justify-around p-2">
        <a href="usuario.html" class="flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary">
          <span class="material-icons">group</span>
          <span class="text-xs">Usuario</span>
        </a>
        <a href="productos.html" class="flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary">
          <span class="material-icons">inventory_2</span>
          <span class="text-xs">Productos</span>
        </a>
        <a href="ventas.html" class="flex flex-col items-center text-primary">
          <span class="material-icons">point_of_sale</span>
          <span class="text-xs">Ventas</span>
        </a>
        <a href="reportes.html" class="flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary">
          <span class="material-icons">bar_chart</span>
          <span class="text-xs">Reportes</span>
        </a>
        <button onclick="cerrarSesion()" class="flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400">
          <span class="material-icons">logout</span>
          <span class="text-xs">Salir</span>
        </button>
      </div>
    </nav>
  </div>

  <!-- ================== SCRIPT FUNCIONAL ================== -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const calendarBody = document.getElementById("calendar-body");
      const monthYear = document.getElementById("month-year");
      const selectedDateText = document.getElementById("selected-date");
      const ventaFechaInput = document.getElementById("venta-fecha");

      let currentDate = new Date();
      let selectedDate = null;

      function renderCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        monthYear.textContent = date.toLocaleString("es-ES", {
          month: "long",
          year: "numeric",
        });

        calendarBody.innerHTML = "";
        let day = 1;

        for (let i = 0; i < 6; i++) {
          const row = document.createElement("tr");
          for (let j = 0; j < 7; j++) {
            const cell = document.createElement("td");

            if ((i === 0 && j < firstDay) || day > daysInMonth) {
              cell.textContent = "";
            } else {
              cell.textContent = day;
              cell.classList.add("cursor-pointer", "hover:bg-blue-200", "dark:hover:bg-blue-800", "rounded-full", "transition");

              const thisDate = new Date(year, month, day);
              cell.addEventListener("click", () => {
                selectedDate = thisDate;
                const formattedDate = thisDate.toLocaleDateString("es-ES", {
                  day: "numeric",
                  month: "long",
                  year: "numeric",
                });

                selectedDateText.textContent = `Fecha seleccionada: ${formattedDate}`;
                ventaFechaInput.value = formattedDate;

                document.querySelectorAll("td").forEach(td =>
                  td.classList.remove("bg-blue-500", "text-white")
                );
                cell.classList.add("bg-blue-500", "text-white");
              });

              day++;
            }
            row.appendChild(cell);
          }
          calendarBody.appendChild(row);
        }
      }

      document.getElementById("prev-month").addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
      });

      document.getElementById("next-month").addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
      });

      renderCalendar(currentDate);

      // ================== FORMULARIO ==================
      const ventaForm = document.getElementById("venta-form");
      ventaForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const datos = {
          fecha: ventaFechaInput.value,
          cantidad: document.getElementById("venta-cantidad").value,
          usuario: document.getElementById("venta-usuario").value,
        };

        if (!datos.fecha) {
          alert("Por favor selecciona una fecha en el calendario.");
          return;
        }

        console.log("Registro de movimiento:", datos);
        alert("Movimiento registrado correctamente ✅ (simulación sin BD)");
        ventaForm.reset();
        selectedDateText.textContent = "Fecha seleccionada: Ninguna";
        ventaFechaInput.value = "";
      });
    });
  </script>
</body>
</html>
